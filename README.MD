# âš—ï¸ Calculadora de SeparaciÃ³n Flash Multicomponente
[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/benmoraing2019/calculadora_termodinamica/blob/main/main.ipynb)


Herramienta de simulaciÃ³n termodinÃ¡mica para separaciÃ³n flash vapor-lÃ­quido (VLE) de mezclas multicomponente, construida sobre **CoolProp HEOS** con el estÃ¡ndar **GERG-2008**.

---

![Dashboard Flash](flash_dashboard.png)

---

## ğŸ“‹ DescripciÃ³n

Este modelo calcula el equilibrio lÃ­quido-vapor de mezclas multicomponente a condiciones especificadas de temperatura y presiÃ³n (flash PT). EstÃ¡ orientado a ingenierÃ­a quÃ­mica de planta y entrega resultados de balances de materia, composiciones por fase, factores de equilibrio K y envolvente de fases.

## ğŸ—‚ï¸ Estructura del Proyecto

```
CALCULADORA_TERMODINAMICA/
â”œâ”€â”€ .devcontainer/
â”‚   â”œâ”€â”€ devcontainer.json    # ConfiguraciÃ³n del contenedor de desarrollo
â”‚   â””â”€â”€ requirements.txt     # Dependencias del entorno DevContainer
â”œâ”€â”€ docs/                    # DocumentaciÃ³n adicional
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â””â”€â”€ config.json      # ConfiguraciÃ³n de mezcla y condiciones
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ ConfigManager.py # Lectura y gestiÃ³n de configuraciÃ³n
â”‚       â”œâ”€â”€ FlashModel.py    # Modelo termodinÃ¡mico (CoolProp)
â”‚       â””â”€â”€ PlotService.py   # Visualizaciones para ingenierÃ­a de planta
â”œâ”€â”€ test.py                  # Script de prueba
â”œâ”€â”€ flash_calculator.ipynb   # Notebook interactivo (Jupyter / Colab)
â”œâ”€â”€ main.ipynb               # Notebook principal
â”œâ”€â”€ flash_dashboard.png      # Ejemplo de salida grÃ¡fica
â”œâ”€â”€ resultados.csv           # Resultados exportados
â””â”€â”€ requirements.txt         # Dependencias raÃ­z
```

## ğŸ³ Entorno de Desarrollo (DevContainer)

Este proyecto estÃ¡ configurado para correr en un **DevContainer** de VS Code, lo que garantiza un entorno reproducible sin instalaciones manuales.

### Requisitos previos

- [VS Code](https://code.visualstudio.com/)
- ExtensiÃ³n [Dev Containers](https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.remote-containers)
- [Docker Desktop](https://www.docker.com/products/docker-desktop/)

### Levantar el entorno

```bash
# 1. Clonar el repositorio
git clone <url-del-repo>
cd CALCULADORA_TERMODINAMICA

# 2. Abrir en VS Code
code .

# 3. VS Code detectarÃ¡ el .devcontainer y mostrarÃ¡:
#    "Reopen in Container" â†’ hacer clic
```

El contenedor instala automÃ¡ticamente todas las dependencias definidas en `.devcontainer/requirements.txt`.

### Estructura del `devcontainer.json`

```json
{
    "name": "Calculadora Termodinamica",
    "image": "mcr.microsoft.com/devcontainers/python:3.10",
    "postCreateCommand": "pip install -r .devcontainer/requirements.txt",
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-python.python",
                "ms-toolsai.jupyter"
            ]
        }
    }
}
```

### InstalaciÃ³n manual (sin DevContainer)

```bash
pip install -r requirements.txt
```

Dependencias principales:

```txt
CoolProp>=6.4.1
numpy
pandas
matplotlib
ipywidgets
```

## ğŸš€ Uso rÃ¡pido

### Desde script Python

```python
from src.services.ConfigManager import ConfigManager
from src.services.FlashModel import FlashModel
from src.services.PlotService import PlotService

# Cargar configuraciÃ³n desde config.json
cfm = ConfigManager()

# Instanciar el modelo (T en Kelvin, P en Pascales)
fm = FlashModel(temperature=200, pressure=2e6, config_manager=cfm)

print(fm.get_phase_name())   # "Bifasico (VLE)"
print(fm.get_results())      # dict con beta, x, y, K

# Generar dashboard de visualizaciones
ps = PlotService(fm)
ps.dashboard(save_path="flash_dashboard.png")
ps.export_csv("resultados.csv")
```

### Desde Jupyter / Google Colab

Abre `flash_calculator.ipynb` y ejecuta las celdas en orden. La interfaz interactiva te permite:

- Ajustar **T** y **P** con sliders
- Activar/desactivar componentes con checkboxes
- Ingresar fracciones molares con normalizaciÃ³n automÃ¡tica
- Visualizar el dashboard completo
- Exportar resultados a CSV

## ğŸ§¬ ConfiguraciÃ³n de la mezcla (`config.json`)

```json
{
    "mezcla": [
        { "id_espanol": "Metano",    "coolprop_name": "Methane",  "z_fraccion_molar": 0.50 },
        { "id_espanol": "Etano",     "coolprop_name": "Ethane",   "z_fraccion_molar": 0.20 },
        { "id_espanol": "Propano",   "coolprop_name": "Propane",  "z_fraccion_molar": 0.15 },
        { "id_espanol": "n-Butano",  "coolprop_name": "n-Butane", "z_fraccion_molar": 0.10 },
        { "id_espanol": "Nitrogeno", "coolprop_name": "Nitrogen", "z_fraccion_molar": 0.05 }
    ],
    "simulacion": {
        "feed": { "flow_kmol_h": 100.0 },
        "flash": {
            "temperature_K": 200.0,
            "pressure_Pa": 2000000.0
        }
    }
}
```

## ğŸ“Š Visualizaciones del Dashboard

| Panel | DescripciÃ³n |
|-------|-------------|
| **Envolvente de fases** | Curvas de burbuja y rocÃ­o (P-T), con punto de operaciÃ³n |
| **Composiciones por fase** | Barras agrupadas z / x (lÃ­quido) / y (vapor) por componente |
| **Factores K (log)** | K = y/x en escala logarÃ­tmica; K>1 va al vapor, K<1 al lÃ­quido |
| **Balance de materia** | Flujos molares (kmol/h) en vapor y lÃ­quido por componente |
| **DistribuciÃ³n de fases** | Barras apiladas de fracciÃ³n del feed en cada fase |
| **Tabla de resultados** | z, x, y, K, F, L, V para todos los componentes + totales |

## ğŸ§ª Componentes soportados (GERG-2008)

Solo se aceptan componentes del estÃ¡ndar GERG-2008, que garantizan parÃ¡metros de interacciÃ³n binaria completos en CoolProp HEOS:

| Grupo | Componentes |
|-------|-------------|
| Gases ligeros | Methane, Nitrogen, CO2, Ethane, Hydrogen, H2S, Oxygen, CO, Water |
| Hidrocarburos | Propane, n-Butane, IsoButane, n-Pentane, Isopentane, n-Hexane, n-Heptane, n-Octane, n-Decane |
| Nobles | Helium, Argon, Neon |

> âš ï¸ Componentes fuera de esta lista (ej. Benceno, aromÃ¡ticos, refrigerantes) requieren asignar parÃ¡metros de interacciÃ³n binaria manualmente con `set_binary_interaction_double()`.

## ğŸ“ Fundamento TermodinÃ¡mico

- **Backend:** CoolProp HEOS (Helmholtz Energy Equation of State)
- **Modelo de mezcla:** GERG-2008 (Kunz & Wagner)
- **Tipo de flash:** PT (temperatura y presiÃ³n especificadas)
- **Inputs del solver:** `CP.PT_INPUTS`
- **Outputs:** fracciÃ³n de vapor Î², composiciones x/y, factores K, propiedades termodinÃ¡micas

## ğŸ—ƒï¸ Salida CSV

El archivo `resultados.csv` contiene por componente:

```
Componente, z, x_liquido, y_vapor, K, F_kmolh, L_kmolh, V_kmolh
```

## ğŸ“„ Licencia

MIT License â€” libre uso acadÃ©mico y comercial.